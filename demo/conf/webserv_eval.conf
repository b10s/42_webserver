server {
	listen 8080 ;
	server_name default_server;
	errorpage 404 html/not_found.html;
	
	location / {
		method GET;
		autoindex on;
		# redirect http://localhost:8080/html/nginx.html;
		index index.html nginx.html;
		root .;
	}

	location /html/ {
		method GET;
		root html;
		autoindex on;
		index index.html;
	}

	location /cgi/ {
		method GET;
		cgi_path cgi/cgi.py;
	}

	location /upload/ {
		method GET POST DELETE;
		root tmp;
		autoindex on;
	}
}

server {
    listen 0.0.0.0:8081;
    server_name primary_service;
    client_max_body_size 5;
    error_page 404 /errors/404_port8080.html;
    error_page 413 /errors/413_large_body.html;
    location / {
        root /var/www/html/site_8080/data;
        index welcome.html;
        allowed_methods GET POST;
        autoindex off;
    }
}


# ===== demo_site :8080 =====
server {
  listen 127.0.0.1:8080;
  server_name demo_site;

  root demo/sites/demo_site;
  index index.html;

  # body size limit (413 test)
  client_max_body_size 1024;

  error_page 404 /errors/404.html;
  error_page 500 /errors/500.html;

  # static files
  location /static {
    root demo/sites/demo_site;
    allow_methods GET;
  }

  # directory listing
  location /dirlist {
    root demo/sites/demo_site/dirlist;
    autoindex on;
    allow_methods GET;
  }

  # upload endpoint (static post)
  location /upload {
    root demo/sites/demo_site/upload;
    allow_methods GET POST DELETE;
  }

  # redirect test
  location /go {
    return 302 /static/a.txt;
  }

  # cgi (mount /cgi to demo/cgi-bin)
  location /cgi {
    root demo/cgi-bin;
    cgi on;
    cgi_extension .py;
    allow_methods GET POST;
  }
}

# ===== secondary_site :8081 =====
server {
  listen 127.0.0.1:8081;
  server_name secondary_site;

  root demo/sites/secondary_site;
  index index.html;

  error_page 404 /errors/404.html;

  location /static {
    root demo/sites/secondary_site;
    allow_methods GET;
  }
}
